<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horaires Navette Frioul</title>
  <link rel="stylesheet" type="text/css" href="./style.css" media="screen" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš¢</text></svg>">
</head>

<body style="max-width: 350px">
  <h1 style="text-align: center;">ðŸš¢ Horaires Frioul</h1>

  <p style="display: flex; align-items: flex-end;">
    <span>
      <a href="javascript:changeDateBy(-1);">< -1 jour</a>
    </span>
    <span id="title-date" style="flex: 1; margin: 0 2rem;"></span>
    <span>
      <a href="javascript:changeDateBy(+1);">+1 jour ></a>
    </span>
  </p>

  <table id="times">
    <thead>
      <tr>
        <th title="Vieux-Port â†’ Frioul">Aller</th>
        <th title="Frioul â†’ Vieux-Port">Retour</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><ul id="times-from-vieux-port"></ul></td>
        <td><ul id="times-from-frioul"></ul></td>
      </tr>
    </tbody>
  </table>
</body>

<script src="./main.js"></script>
<script>
  const currentDate = new Date()
  let schedules = null;
  const setDate = date => {
    document.getElementById("title-date").innerHTML = dateToStrFR(date)
    const schedule = getScheduleForDate(schedules, date)
    const mappings = [
    ["Vieux-Port vers Frioul", "#times-from-vieux-port"],
    ["Frioul vers Vieux-Port", "#times-from-frioul"]
    ]
    mappings.forEach(([key, sel]) => {
      const times = schedule.times[key]
      const timesHTML = times.map(t => `<li>${t}</li>`).join("\n")
      document.querySelector(sel).innerHTML = timesHTML
      if (datesEqual(new Date(), date)) {
        const nextIdx = getFirstNextTimeIdx(times, date)
        const li = document.querySelector(`${sel} li:nth-child(${nextIdx + 1})`)
        li.innerHTML = `<mark>${li.innerHTML}</mark>`
      }
    })
  }

  fetch("./schedules.json")
    .then(r => r.text())
    .then(rawSchedulesText => {
      schedules = parseSchedules(rawSchedulesText)
      setDate(currentDate)
  })

  const changeDateBy = (inc) => {
    currentDate.setDate(currentDate.getDate() + inc)
    setDate(currentDate)
  }
</script>

<style>
  #times ul{
    list-style-type: none;
    padding: 0;
  }
</style>

<body>
