<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horaires Navette Frioul</title>
  <link rel="stylesheet" type="text/css" href="./style.css" media="screen" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš¢</text></svg>">
</head>

<body style="max-width: 350px">
  <header style="text-align: center;">
    <h1>ðŸš¢ Horaires Frioul</h1>

    <p style="display: flex; align-items: flex-end;">
      <span>
        <a href="javascript:changeDateBy(-1);">< -1 jour</a>
      </span>
      <span id="title-date" style="flex: 1; margin: 0 2rem;"></span>
      <span>
        <a href="javascript:changeDateBy(+1);">+1 jour ></a>
      </span>
    </p>
  </header>

  <table id="times">
    <thead>
      <tr>
        <th title="Vieux-Port â†’ Frioul">Aller</th>
        <th title="Frioul â†’ Vieux-Port">Retour</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</body>

<script src="./main.js"></script>
<script>
  const currentDate = new Date()
  let schedules = null;
  const tbody = document.querySelector("#times tbody")
  const setDate = date => {
    document.getElementById("title-date").innerHTML = dateToStrFR(date)
    const schedule = getScheduleForDate(schedules, date)
    const maxLength = Math.max(...schedule.times.map(t => t.length))
    const nextIndexes = schedule.times.map(t => getFirstNextTimeIdx(t, date))
    const isToday = datesEqual(new Date(), date)
    tbody.innerHTML = ""
    for(let i=0; i < maxLength; i++) {
      if (isToday && i < nextIndexes[0] && i < nextIndexes[1]) {
        if (tbody.innerHTML == "") {
          tbody.innerHTML = "<tr><td>...</td><td>...</td></tr>"
        }
        continue
      }
      const cellsHTML = schedule.times
        .map(times => times[i] || "")
        .map((time, ii) => (isToday && i == nextIndexes[ii]) ? `<mark>${time}</mark>` : time)
        .map(time => `<td>${time}</td>`).join("\n")
      tbody.innerHTML += `<tr>${cellsHTML}</tr>`
    }
  }

  fetch("./schedules.json")
    .then(r => r.text())
    .then(rawSchedulesText => {
      schedules = parseSchedules(rawSchedulesText)
      setDate(currentDate)
  })

  const changeDateBy = (inc) => {
    currentDate.setDate(currentDate.getDate() + inc)
    setDate(currentDate)
  }
</script>

<hr style="margin-top: 60px;" />

<small style="font-style: italic;">
  <p>
    Ce site prÃ©sente les horaires de la navette du Frioul dans un format plus lisible
  </p>
  <a href="https://lebateau-frioul-if.fr/horaires">Site Officiel Le Bateau â†—</a>
  Â·
  <a href="https://github.com/adipasquale/frioul">Code Source sur GitHub â†—</a>
</small>

<body>
